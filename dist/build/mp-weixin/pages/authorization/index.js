(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/authorization/index"],{1452:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(n("6b82")),o=i(n("5315"));function i(e){return e&&e.__esModule?e:{default:e}}var r=function(){n.e("common/model/wxLogin/index").then(function(){return resolve(n("3095"))}.bind(null,n)).catch(n.oe)},d={mixins:[a.default],data:function(){return{userInfo:{},authorizeFlag:!1,retry:1,loginRetry:1,wxLoginParams:""}},onShow:function(){this.zhuge.track("微信授权"),this.fmagentInit()},methods:{getUserInfo:function(t){this.wxLoginParams=t,this.authorizeFlag=!0,e.hideLoading()},getphonenumber:function(t){"getPhoneNumber:ok"==t.detail.errMsg?this.wechatMiniAuthTelephone(t.detail):e.showToast({title:"获取失败",icon:"none"})},uniGetUserInfo:function(){var t=this;e.login({success:function(n){t.$set(t.wxLoginParams,"code",n.code),t.$set(t.wxLoginParams,"telephone",e.getStorageSync("userInfoTelphone")),t.$set(t.wxLoginParams,"inviteCode",e.getStorageSync("routerShareNumber")?e.getStorageSync("routerShareNumber"):""),t.wechatMiniAuth()}})},wechatMiniAuthTelephone:function(t){var n=this,a={encryptedData:t.encryptedData,iv:t.iv};e.login({success:function(){e.login({success:function(i){a.code=i.code,o.default.wechatMiniAuthTelephone(a).then((function(a){if(200==a.data.code)e.setStorageSync("userInfoTelphone",a.data.data),n.uniGetUserInfo();else{if(n.retry>3)return void e.showToast({title:a.data.message,icon:"none"});n.retry++,n.wechatMiniAuthTelephone(t)}}))}})}})},wechatMiniAuth:function(){var t=this;o.default.wechatMiniAuth(this.wxLoginParams).then((function(n){if(200==n.data.code)t.zhuge.identify(n.data.data.telephone),t.judgeLoginType(n);else{if(t.loginRetry>3)return void e.showToast({title:n.data.message,icon:"none"});t.loginRetry++,t.uniGetUserInfo()}}))},judgeLoginType:function(t){t.data.data.hasBindTel?t.data.data.needResetPwd?this.$Router.replace({path:"/pages/modifyPwdForLogin/index",query:{loginName:t.data.data.userName,telephone:t.data.data.telephone,resetPwdCode:t.data.data.resetPwdCode,isLogin:!0}}):t.data.data.needVerifyTel?this.$Router.replace({path:"/pages/modifyPwdForLogin/index",query:{loginName:t.data.data.userName,telephone:t.data.data.telephone,resetPwdCode:t.data.data.resetPwdCode,verifyTel:!0,isLogin:!0}}):(e.setStorageSync("sessionId",t.data.data.sessionId),e.setStorageSync("shareNumber",t.data.data.shareNumber),e.setStorageSync("userInfo",JSON.stringify(t.data.data)),e.showToast({title:"登录成功",icon:"none"}),this.goBack(2)):this.$Router.replace({path:"/pages/phoneCheck/index",query:{loginName:t.data.data.userName,operateCode:t.data.data.bindTelCode,isLogin:!0}})}},components:{wxLogin:r}};t.default=d}).call(this,n("543d")["default"])},"15a3":function(e,t,n){},"29f8":function(e,t,n){"use strict";var a=n("15a3"),o=n.n(a);o.a},"381b":function(e,t,n){"use strict";n.r(t);var a=n("1452"),o=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=o.a},"7f0e":function(e,t,n){"use strict";var a;n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a}));var o=function(){var e=this,t=e.$createElement;e._self._c},i=[]},c099:function(e,t,n){"use strict";(function(e){n("6cdc");a(n("66fd"));var t=a(n("e489"));function a(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},e489:function(e,t,n){"use strict";n.r(t);var a=n("7f0e"),o=n("381b");for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("29f8");var r,d=n("f0c5"),u=Object(d["a"])(o["default"],a["b"],a["c"],!1,null,"755233e2",null,!1,a["a"],r);t["default"]=u.exports}},[["c099","common/runtime","common/vendor"]]]);