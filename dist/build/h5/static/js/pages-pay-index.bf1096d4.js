(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-pay-index"],{"0177":function(e,t,a){"use strict";var i;a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return i}));var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"page commonPageTitle"},[a("defaultTitle",{attrs:{dto:e.defaultTitleDto}}),a("v-uni-view",{staticClass:"orderPrice"},[e._v("应付"),e.payInfo.payedSummary?a("v-uni-text",{staticClass:"orderAmount"},[e._v("￥"+e._s(e.surplusMoney?e.surplusMoney:""))]):a("v-uni-text",{staticClass:"orderAmount"},[e._v("￥"+e._s(e.payInfo.orderAmount?e.payInfo.orderAmount:""))]),a("v-uni-view",{staticClass:"orderDetailsBtn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.payFlag=!e.payFlag}}},[e._v(e._s(e.payFlag?"收起":"详情")),a("v-uni-text",{class:e.payFlag?"active":""})],1)],1),e.payFlag?a("v-uni-view",{staticClass:"orderPriceMain"},[a("v-uni-view",{staticClass:"everyRow"},[a("v-uni-text",[e._v("商品金额")]),a("v-uni-text",[e._v("￥"+e._s(e.payInfo.orderSummary.goodsAmount))])],1),a("v-uni-view",{staticClass:"everyRow"},[a("v-uni-text",[e._v("运费")]),a("v-uni-text",[e._v("￥"+e._s(e.payInfo.orderSummary.freightAmount))])],1),a("v-uni-view",{staticClass:"everyRow"},[a("v-uni-text",[e._v("库豆抵扣")]),a("v-uni-text",[e._v("-￥"+e._s(e.payInfo.orderSummary.goldAmount))])],1),a("v-uni-view",{staticClass:"everyRow"},[a("v-uni-text",[e._v("积分抵扣")]),a("v-uni-text",[e._v("-￥"+e._s(e.payInfo.orderSummary.scorePayedAmount))])],1)],1):e._e(),a("v-uni-view",{staticClass:"myWalletHead"},[e._v("文器库商城支付")]),e.payInfo.payedSummary?e._e():a("v-uni-view",{staticClass:"myWalletInfo"},[e.payInfo.memberAsset&&e.payInfo.memberAsset.balance<=0?a("v-uni-view",{staticClass:"mask"}):e._e(),a("v-uni-view",{staticClass:"walletIcon"}),a("v-uni-view",{staticClass:"walletText"},[a("v-uni-view",{staticClass:"walletType"},[e._v("账户余额")]),a("v-uni-view",{staticClass:"walletPrice"},[e._v("余额￥"+e._s(e.payInfo.memberAsset?e.payInfo.memberAsset.accountBalance:0)+" 可用￥"+e._s(e.payInfo.memberAsset.balance?e.payInfo.memberAsset.balance:0))])],1),"-1"!=e.chooseTypeList.indexOf("账户余额")?a("v-uni-view",{staticClass:"payPrice"},[e._v("￥"+e._s(e.payInfo.memberAsset.balanceUseMoney))]):e._e(),a("v-uni-view",{staticClass:"payChooseBtn",class:"-1"!=e.chooseTypeList.indexOf("账户余额")?"active":"",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.accountChange()}}})],1),e.payInfo.payedSummary&&e.payInfo.payedSummary.balanceAmount?a("v-uni-view",{staticClass:"myWalletInfo"},[a("v-uni-view",{staticClass:"walletIcon"}),a("v-uni-view",{staticClass:"walletText"},[a("v-uni-view",{staticClass:"walletType"},[e._v("账户余额")])],1),a("v-uni-view",{staticClass:"payPrice"},[e._v("￥"+e._s(e.payInfo.payedSummary.balanceAmount?e.payInfo.payedSummary.balanceAmount:0))])],1):e._e(),e.payInfo.memberAsset&&!e.payInfo.payedSummary?a("v-uni-view",{staticClass:"myWalletInfo",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.openGiftCardPopup.apply(void 0,arguments)}}},[e.payInfo.memberAsset.cardAmount<=0?a("v-uni-view",{staticClass:"mask"}):e._e(),a("v-uni-view",{staticClass:"walletIcon icon_m"}),a("v-uni-view",{staticClass:"walletText"},[a("v-uni-view",{staticClass:"walletType"},[e._v("礼卡")]),a("v-uni-view",{staticClass:"walletPrice"},[e._v("余额￥"+e._s(e.payInfo.memberAsset.accountCard)+" 可用￥"+e._s(e.payInfo.memberAsset.cardAmount))])],1),"-1"!=e.chooseTypeList.indexOf("礼卡")?a("v-uni-view",{staticClass:"payPrice"},[e._v("￥"+e._s(e.payInfo.memberAsset.cardUseMoney))]):e._e(),this.payInfo.payedSummary?e._e():a("v-uni-view",{staticClass:"payChooseBtn",class:"-1"!=e.chooseTypeList.indexOf("礼卡")?"active":"",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.giftChange.apply(void 0,arguments)}}})],1):e._e(),e.payInfo.payedSummary&&e.payInfo.payedSummary.cardAmount?a("v-uni-view",{staticClass:"myWalletInfo",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.openGiftCardPopup.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"walletIcon icon_m"}),a("v-uni-view",{staticClass:"walletText"},[a("v-uni-view",{staticClass:"walletType"},[e._v("礼卡")])],1),a("v-uni-view",{staticClass:"payPrice"},[e._v("-￥"+e._s(e.payInfo.payedSummary.cardAmount))])],1):e._e(),a("v-uni-view",{staticClass:"myWalletHead"},[e._v("其它方式支付")]),e.isWxFlag?e._e():a("v-uni-view",{staticClass:"payType"},[e.surplusMoney<=0?a("v-uni-view",{staticClass:"mask"}):e._e(),a("v-uni-view",{staticClass:"alipayIcon"}),a("v-uni-view",{staticClass:"payText"},[e._v("支付宝支付")]),"-1"!=e.chooseTypeList.indexOf("支付宝")?a("v-uni-view",{staticClass:"payPrice"},[e._v("￥"+e._s(Number(e.surplusMoney).toFixed(2)))]):e._e(),a("v-uni-view",{staticClass:"payChooseBtn",class:"-1"!=e.chooseTypeList.indexOf("支付宝")?"active":"",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.outsideStationChange("支付宝")}}})],1),e.isWxFlag?a("v-uni-view",{staticClass:"payType"},[e.surplusMoney<=0?a("v-uni-view",{staticClass:"mask"}):e._e(),a("v-uni-view",{staticClass:"weixinIcon"}),a("v-uni-view",{staticClass:"payText"},[e._v("微信")]),"-1"!=e.chooseTypeList.indexOf("微信")?a("v-uni-view",{staticClass:"payPrice"},[e._v("￥"+e._s(Number(e.surplusMoney).toFixed(2)))]):e._e(),a("v-uni-view",{staticClass:"payChooseBtn",class:"-1"!=e.chooseTypeList.indexOf("微信")?"active":"",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.outsideStationChange("微信")}}})],1):e._e(),e.payInfo.payedSummary?a("v-uni-view",{staticClass:"surePayBtn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.openPswPopup.apply(void 0,arguments)}}},[e._v(e._s(e.chooseTypeList.length>1?"组合":e.chooseTypeList[0])+"支付￥"+e._s(e.surplusMoney)+"元")]):a("v-uni-view",{staticClass:"surePayBtn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.openPswPopup.apply(void 0,arguments)}}},[e._v(e._s(e.chooseTypeList.length>1?"组合":e.chooseTypeList[0])+"支付￥"+e._s(e.payInfo.orderAmount?e.payInfo.orderAmount:"")+"元")]),a("pswPopup",{ref:"pswPopup",on:{openForgetPopup:function(t){arguments[0]=t=e.$handleEvent(t),e.openForgetPopup.apply(void 0,arguments)},submitPay:function(t){arguments[0]=t=e.$handleEvent(t),e.setSubmitPsw.apply(void 0,arguments)}}}),a("setPayPwd",{ref:"setPayPwd",attrs:{payInfo:e.payInfo},on:{openPswPopup:function(t){arguments[0]=t=e.$handleEvent(t),e.openPswPopup.apply(void 0,arguments)},submitPay:function(t){arguments[0]=t=e.$handleEvent(t),e.setSubmitPsw.apply(void 0,arguments)}}}),a("forgetPayPsw",{ref:"forgetPayPsw",attrs:{payInfo:e.payInfo},on:{openPswPopup:function(t){arguments[0]=t=e.$handleEvent(t),e.openPswPopup.apply(void 0,arguments)},submitPay:function(t){arguments[0]=t=e.$handleEvent(t),e.setSubmitPsw.apply(void 0,arguments)}}}),a("verificationCode",{ref:"verificationCode",attrs:{payInfo:e.payInfo,isSendSMS:!0},on:{codeSubmit:function(t){arguments[0]=t=e.$handleEvent(t),e.codeSubmit.apply(void 0,arguments)}}}),a("cardList",{ref:"giftCard",attrs:{cardInfo:e.cardInfo,payInfo:e.payInfo},on:{cardAmountChange:function(t){arguments[0]=t=e.$handleEvent(t),e.cardAmountChange.apply(void 0,arguments)}}})],1)},n=[]},1429:function(e,t,a){"use strict";var i=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(a("1087")),n={props:["cardInfo","payInfo"],data:function(){return{imgBaseUrls:""}},methods:{openGiftCardPopup:function(){this.$refs.giftCardInfo.open()},closeGiftCardPopup:function(){this.$refs.giftCardInfo.close()},detailsChange:function(e){this.$set(e,"flag",!e.flag)},chooseChange:function(e){this.payInfo.memberAsset.cardUseMoney=this.payInfo.memberAsset.cardUseMoney?this.payInfo.memberAsset.cardUseMoney:0,e.seleted?(e.seleted=!1,this.payInfo.memberAsset.cardUseMoney=this.payInfo.memberAsset.cardUseMoney-e.usefulAmount):(e.seleted=!0,this.payInfo.memberAsset.cardUseMoney=this.payInfo.memberAsset.cardUseMoney+e.usefulAmount),this.selectCards()},selectCards:function(){for(var e=this,t=[],a=0;a<this.cardInfo.usableCards.length;a++)this.cardInfo.usableCards[a].seleted&&t.push({cardNo:this.cardInfo.usableCards[a].cardNo,amt:this.cardInfo.usableCards[a].usefulAmount});var i={balance:this.payInfo.memberAsset.balanceUseMoney?this.payInfo.memberAsset.balanceUseMoney:0,cardAmount:this.payInfo.memberAsset.cardUseMoney,cards:t,payId:this.$Route.query.payId};s.default.selectCards(i).then((function(t){200==t.data.code?e.$emit("cardAmountChange",t.data.data):uni.showToast({title:t.data.message,icon:"none"})}))}},mounted:function(){this.imgBaseUrls=this.$config.imgBaseUrl}};t.default=n},"145b":function(e,t,a){"use strict";var i=a("45e5"),s=a.n(i);s.a},"15fc":function(e,t,a){"use strict";a.r(t);var i=a("0177"),s=a("bae4");for(var n in s)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(n);a("145b");var o,r=a("f0c5"),c=Object(r["a"])(s["default"],i["b"],i["c"],!1,null,"6b6c956f",null,!1,i["a"],o);t["default"]=c.exports},"2c57":function(e,t,a){"use strict";var i=a("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var s=i(a("5e8a")),n=i(a("b775")),o={buildMiniPrepPaySign:function(e){return n.default.post(s.default.buildMiniPrepPaySign,e)},buildPrepPaySign:function(e){return n.default.post(s.default.buildPrepPaySign,e)}};t.default=o},3124:function(e,t,a){"use strict";a.r(t);var i=a("1429"),s=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(n);t["default"]=s.a},3392:function(e,t,a){var i=a("e50c");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var s=a("4f06").default;s("3ecffa74",i,!0,{sourceMap:!1,shadowMode:!1})},"45e5":function(e,t,a){var i=a("62d8");"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var s=a("4f06").default;s("5a5cbb12",i,!0,{sourceMap:!1,shadowMode:!1})},"5e8a":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i={buildMiniPrepPaySign:"/payment/wechat/buildMiniPrepPaySign",buildPrepPaySign:"/payment/wechat/buildPrepPaySign"},s=i;t.default=s},"62d8":function(e,t,a){var i=a("4bad");t=i(!1),t.push([e.i,".commonPageTitle[data-v-6b6c956f]{\npadding-top:%?88?%;\nmin-height:100vh;background-color:#fff}.orderPrice[data-v-6b6c956f]{width:100%;height:%?80?%;text-align:center;line-height:%?80?%;position:relative;font-size:%?34?%;\n}.orderAmount[data-v-6b6c956f]{color:#ff1558}.orderDetailsBtn[data-v-6b6c956f]{position:absolute;right:%?24?%;top:0;font-size:%?24?%;color:#666;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.orderDetailsBtn uni-text[data-v-6b6c956f]{display:inline-block;width:%?40?%;height:%?80?%;background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/coupon_cannotusearrow@2x.png) no-repeat 50%;background-size:%?20?% %?10?%}.orderPriceMain[data-v-6b6c956f]{width:100%;padding:%?24?%;background-color:#fff}.everyRow[data-v-6b6c956f]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;font-size:%?24?%;color:#999;margin:%?5?% 0}.myWalletHead[data-v-6b6c956f]{margin-top:%?48?%;padding:%?24?%;width:100%;font-size:%?34?%;color:#333;font-weight:700}.myWalletInfo[data-v-6b6c956f]{display:-webkit-box;display:-webkit-flex;display:flex;padding:%?30?% %?24?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center;position:relative}.walletIcon[data-v-6b6c956f],\n.alipayIcon[data-v-6b6c956f],\n.weixinIcon[data-v-6b6c956f]{width:%?60?%;height:%?80?%;background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/icon_qb.png) no-repeat 50%;background-size:%?50?% %?50?%}.alipayIcon[data-v-6b6c956f]{background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/icon_zhi.png) no-repeat 50%;background-size:%?50?% %?50?%}.weixinIcon[data-v-6b6c956f]{background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/icon_weixin.png) no-repeat 50%;background-size:%?50?% %?50?%}.icon_m[data-v-6b6c956f]{background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/icon_m.png) no-repeat 50%;background-size:%?50?% %?50?%}.payText[data-v-6b6c956f]{-webkit-box-flex:1;-webkit-flex:1;flex:1;line-height:%?80?%;padding:0 %?18?%}.walletText[data-v-6b6c956f]{-webkit-box-flex:1;-webkit-flex:1;flex:1;padding:0 %?20?%}.walletType[data-v-6b6c956f]{height:%?40?%;line-height:%?40?%;color:#333}.walletPrice[data-v-6b6c956f]{color:#999;font-size:%?24?%;line-height:%?40?%}.surePayBtn[data-v-6b6c956f]{width:100%;height:%?100?%;background-color:#ff1558;color:#fff;position:fixed;bottom:calc(%?0?% + constant(safe-area-inset-bottom));bottom:calc(%?0?% + env(safe-area-inset-bottom));left:0;text-align:center;line-height:%?100?%}.payPrice[data-v-6b6c956f]{line-height:%?80?%;font-size:%?32?%;color:#333}.payChooseBtn[data-v-6b6c956f]{width:%?36?%;height:%?36?%;background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/oval_3copy4@2x.png) no-repeat 50%;background-size:%?36?% %?36?%;margin-left:%?20?%}.payChooseBtn.active[data-v-6b6c956f]{background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/subr.png) no-repeat 50%;background-size:%?36?% %?36?%}.payType[data-v-6b6c956f]{width:100%;display:-webkit-box;display:-webkit-flex;display:flex;padding:%?30?% %?24?%;-webkit-box-align:center;-webkit-align-items:center;align-items:center;position:relative}.mask[data-v-6b6c956f]{width:100%;height:100%;position:absolute;top:0;left:0;background-color:hsla(0,0%,100%,.5)}",""]),e.exports=t},ad7d:function(e,t,a){"use strict";a.r(t);var i=a("fa2a"),s=a("3124");for(var n in s)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return s[e]}))}(n);a("de2c");var o,r=a("f0c5"),c=Object(r["a"])(s["default"],i["b"],i["c"],!1,null,"37d92636",null,!1,i["a"],o);t["default"]=c.exports},b06f:function(e,t,a){"use strict";var i=a("4ea4");a("c740"),a("c975"),a("a434"),a("a9e3"),a("b680"),a("ac1f"),a("466d"),a("5319"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("96cf");var s=i(a("1da1")),n=i(a("1087")),o=i(a("2c57")),r=i(a("081b")),c=i(a("b1f7")),d=i(a("4406")),u=i(a("639e")),l=i(a("dcca")),p=i(a("ad7d")),f={data:function(){return{payInfo:{},payFlag:!1,submitParams:{payId:"",score:0,password:"",thirdPayAmount:0,thirdPayMethod:"alipay",cardAmount:0,balance:""},cardInfo:{},isWxFlag:!0,chooseTypeList:[],surplusMoney:0,oldBalance:0,wxCode:"",defaultTitleDto:{title:"收银台"}}},methods:{summary:function(){var e=this;n.default.summary(this.$Route.query.payId).then((function(t){200==t.data.code?(t.data.data.maxPkgPay<t.data.data.memberAsset.balance&&(t.data.data.memberAsset.balance=t.data.data.maxPkgPay),e.oldBalance=t.data.data.memberAsset.balance,e.payInfo=t.data.data,e.initChoose()):uni.showToast({title:t.data.message,icon:"none"})}))},initChoose:function(){var e=this;return(0,s.default)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.payInfo.payedSummary){t.next=14;break}if(!e.payInfo.memberAsset.balance){t.next=6;break}return e.chooseTypeList.push("账户余额"),e.$set(e.payInfo.memberAsset,"balanceUseMoney",e.payInfo.memberAsset.balance),t.next=6,e.defaultCards();case 6:if(!e.payInfo.memberAsset.cardAmount){t.next=11;break}return e.chooseTypeList.push("礼卡"),e.$set(e.payInfo.memberAsset,"cardUseMoney",e.payInfo.memberAsset.cardAmount),t.next=11,e.defaultCards();case 11:e.judegChooseOther(),t.next=16;break;case 14:e.surplusMoney=e.payInfo.needPay,e.judegChooseOther();case 16:case"end":return t.stop()}}),t)})))()},defaultCards:function(){var e=this;return(0,s.default)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={balance:"-1"!=e.chooseTypeList.indexOf("账户余额")?e.payInfo.memberAsset.balanceUseMoney:0,payId:e.$Route.query.payId,cardAmount:"-1"!=e.chooseTypeList.indexOf("礼卡")?e.payInfo.memberAsset.cardUseMoney:0},t.next=3,n.default.defaultCards(a).then((function(t){200==t.data.code?(e.cardInfo=t.data.data,e.$set(e.payInfo.memberAsset,"cardAmount",t.data.data.usefulAmount)):uni.showToast({title:t.data.message,icon:"none"})}));case 3:case"end":return t.stop()}}),t)})))()},judgeSurplusMoney:function(){for(var e=0,t=0;t<this.chooseTypeList.length;t++)switch(this.chooseTypeList[t]){case"账户余额":e+=this.payInfo.memberAsset.balanceUseMoney;break;case"礼卡":e+=this.payInfo.memberAsset.cardUseMoney;break}return this.payInfo.payedSummary||(this.surplusMoney=this.payInfo.orderAmount-e),this.surplusMoney},judegChooseOther:function(){this.isWxFlag?-1!=this.judgeTypeIsExistence("微信")&&this.judgeSurplusMoney()<=0?this.chooseTypeList.splice(this.judgeTypeIsExistence("微信"),1):this.judgeSurplusMoney()>0&&-1==this.judgeTypeIsExistence("微信")&&this.chooseTypeList.push("微信"):this.isWxFlag||(-1!=this.judgeTypeIsExistence("支付宝")&&this.judgeSurplusMoney()<=0?this.chooseTypeList.splice(this.judgeTypeIsExistence("支付宝"),1):this.judgeSurplusMoney()>0&&-1==this.judgeTypeIsExistence("支付宝")&&this.chooseTypeList.push("支付宝"))},accountChange:function(){var e=this;return(0,s.default)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return-1!=e.judgeTypeIsExistence("账户余额")?(e.chooseTypeList.splice(e.judgeTypeIsExistence("账户余额"),1),e.payInfo.memberAsset.balanceUseMoney=0):(e.chooseTypeList.push("账户余额"),e.payInfo.memberAsset.balanceUseMoney=e.payInfo.memberAsset.balance),t.next=3,e.defaultCards();case 3:e.judegChooseOther(),-1==e.judgeTypeIsExistence("账户余额")&&(e.payInfo.memberAsset.cardUseMoney?e.payInfo.memberAsset.balance=e.surplusMoney<e.oldBalance?e.surplusMoney:e.oldBalance:e.payInfo.memberAsset.balance=e.oldBalance);case 5:case"end":return t.stop()}}),t)})))()},giftChange:function(){var e=this;return(0,s.default)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return-1!=e.judgeTypeIsExistence("礼卡")?(e.chooseTypeList.splice(e.judgeTypeIsExistence("礼卡"),1),e.payInfo.memberAsset.cardUseMoney=0):(e.chooseTypeList.push("礼卡"),e.payInfo.memberAsset.cardUseMoney=e.payInfo.memberAsset.cardAmount),t.next=3,e.defaultCards();case 3:e.judegChooseOther(),-1==e.judgeTypeIsExistence("账户余额")&&(e.payInfo.memberAsset.balance=e.oldBalance-e.surplusMoney>0?e.surplusMoney:e.oldBalance);case 5:case"end":return t.stop()}}),t)})))()},outsideStationChange:function(e){var t=this.judgeTypeIsExistence(e);"-1"!=t&&2==this.judgeIsExistence()&&("微信"==e?this.chooseTypeList.splice(t,1,"支付宝"):this.chooseTypeList.splice(t,1,"微信"))},cardAmountChange:function(e){this.cardInfo=e,this.$set(this.payInfo.memberAsset,"cardUseMoney",e.selectedAmount),-1==this.judgeTypeIsExistence("礼卡")?this.chooseTypeList.push("礼卡"):this.payInfo.memberAsset.cardUseMoney||-1==this.judgeTypeIsExistence("礼卡")||this.chooseTypeList.splice(this.judgeTypeIsExistence("礼卡"),1),this.judegChooseOther(),this.payInfo.memberAsset.balance=this.oldBalance-this.surplusMoney>0?this.surplusMoney:this.oldBalance},judgeTypeIsExistence:function(e){var t=this.chooseTypeList.findIndex((function(t){return t==e}));return t},judgeIsExistence:function(){var e=0;return this.isWxFlag&&e++,this.isWxFlag||e++,e},openPswPopup:function(){this.payInfo.orderSummary.scorePayedAmount||"-1"!=this.judgeTypeIsExistence("礼卡")||"-1"!=this.judgeTypeIsExistence("账户余额")?(console.log(this.payInfo),this.payInfo.riskCheck&&"MID"==this.payInfo.riskCheck.riskLevel||this.payInfo.riskCheck&&"LOW"==this.payInfo.riskCheck.riskLevel&&this.payInfo.riskCheck.firstAddrMobile&&!this.payInfo.riskCheck.monthNewMember&&this.payInfo.riskCheck&&this.payInfo.riskCheck.unsafeAmt<this.payInfo.memberAsset.cardUseMoney+this.payInfo.memberAsset.scorePayedAmount+this.payInfo.memberAsset.balanceUseMoney?this.$refs.verificationCode.openVerificationCode():this.payInfo.hasPayPwd?this.$refs.pswPopup.openPswPopup():this.$refs.setPayPwd.openNoPswPopup()):this.getH5Code()},buildMiniPrepPaySign:function(e,t){var a=this,i="good";this.$Route.query.increase?i="giftbag":this.$Route.query.newtype>50&&(i="newtype"),o.default.buildMiniPrepPaySign({code:e,orderPayId:t||this.$Route.query.payId,orderType:i}).then((function(e){200==e.data.code?a.requestpayment(e.data.data):uni.showToast({title:e.data.message,icon:"none"})}))},buildPrepPaySign:function(){var e=this;o.default.buildPrepPaySign({code:this.wxCode,orderPayId:this.$Route.query.payId,orderType:"good"}).then((function(t){200==t.data.code?e.requestH5Payment(t.data.data):uni.showToast({title:t.data.message,icon:"none"})}))},requestpayment:function(e){var t=this;uni.requestPayment({provider:"payment",timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,paySign:e.paySign,signType:e.signType,success:function(e){t.payCallBack(!0)},fail:function(e){t.payCallBack(!1)}})},requestH5Payment:function(e){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",this.WeixinJSBridgeH5,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",this.WeixinJSBridgeH5),document.attachEvent("onWeixinJSBridgeReady",this.WeixinJSBridgeH5)):this.WeixinJSBridgeH5(e)},WeixinJSBridgeH5:function(e){var t=this;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.appId,timeStamp:e.timeStamp,nonceStr:e.nonceStr,package:e.package,signType:e.signType,paySign:e.paySign},(function(e){"get_brand_wcpay_request:ok"==e.err_msg?t.payCallBack(!0):(e.err_msg,t.payCallBack(!1))}))},payCallBack:function(e){var t=this;e?(uni.showToast({title:"支付成功",icon:"none"}),this.$Router.replace({path:"/pages/payment/index",query:{payId:this.$Route.query.payId,newtype:this.$Route.query.newtype,increase:this.$Route.query.increase||""}})):(uni.showToast({title:"已取消支付,正在前往订单页",icon:"none"}),setTimeout((function(){t.$Router.replace({path:"/pages/order/index"})}),500))},getH5Code:function(){var e=this;r.default.wxPubAppId().then((function(t){if(200==t.data.code){var a="https://"+location.host+location.pathname+"?payId="+e.$Route.query.payId;location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+t.data.data+"&redirect_uri="+encodeURIComponent(a)+"&response_type=code&scope=snsapi_userinfo"}else uni.showToast({title:t.data.message,icon:"none"})}))},openForgetPopup:function(){this.$refs.forgetPayPsw.openForgetPopup()},setSubmitPsw:function(e){this.submitParams.password=e,this.submit()},codeSubmit:function(e){this.$set(this.submitParams,"code",e),this.submit()},submit:function(){var e=this;this.submitParams={balance:this.payInfo.memberAsset.balanceUseMoney?this.payInfo.memberAsset.balanceUseMoney:0,password:this.submitParams.password,payId:this.$Route.query.payId,score:this.payInfo.orderSummary.scorePayedAmount,thirdPayAmount:Number(this.surplusMoney).toFixed(2),thirdPayMethod:"1"!=this.chooseTypeList.indexOf("支付宝")?"alipay":"wxpay",code:this.submitParams.code,cardAmount:this.payInfo.memberAsset.cardUseMoney?this.payInfo.memberAsset.cardUseMoney:0},n.default.submitPay(this.submitParams).then((function(t){if(200==t.data.code){if(e.$refs.verificationCode.closeVerificationCode(),"-1"!=e.judgeTypeIsExistence("微信"))return uni.showLoading({title:"正在前往微信支付",mask:!1}),void uni.login({success:function(a){e.buildMiniPrepPaySign(a.code,t.data.data)}});e.payCallBack(!0)}else uni.showToast({title:t.data.message,icon:"none"})}))},openGiftCardPopup:function(){this.cardInfo.usableCards&&this.cardInfo.usableCards.length&&this.$refs.giftCard.openGiftCardPopup()}},onLoad:function(e){var t=navigator.userAgent.toLowerCase();"micromessenger"==t.match(/MicroMessenger/i)?this.isWxFlag=!0:this.isWxFlag=!1,this.submitParams.payId=this.$Route.query.payId,this.summary(),e.code&&(this.wxCode=e.code,this.buildPrepPaySign())},onShow:function(){this.zhuge.track("订单收银台-落地页")},components:{setPayPwd:c.default,forgetPayPsw:d.default,pswPopup:u.default,verificationCode:l.default,cardList:p.default}};t.default=f},bae4:function(e,t,a){"use strict";a.r(t);var i=a("b06f"),s=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(n);t["default"]=s.a},de2c:function(e,t,a){"use strict";var i=a("3392"),s=a.n(i);s.a},e50c:function(e,t,a){var i=a("4bad");t=i(!1),t.push([e.i,".cardList[data-v-37d92636]{width:100%;height:calc(100vh - %?300?%);background-color:#fff}.cardTitle[data-v-37d92636]{width:100%;height:%?100?%;text-align:center;line-height:%?100?%;border-bottom:%?1?% solid #e4e4e4}.giftCardList[data-v-37d92636]{height:calc(100% - %?200?%);background-color:#fff}.everyRowParent[data-v-37d92636]{width:100%;padding:12px;position:relative;border-bottom:%?1?% solid #e4e4e4}.everyRow[data-v-37d92636]{display:-webkit-box;display:-webkit-flex;display:flex}.mask[data-v-37d92636]{width:100%;height:100%;position:absolute;left:0;top:0;background:hsla(0,0%,100%,.3);z-index:1}.giftCardInfo[data-v-37d92636]{width:100%;height:68px;display:-webkit-box;display:-webkit-flex;display:flex}.giftCardImage[data-v-37d92636]{width:90px;height:68px;position:relative;margin-right:12px;border-radius:%?10?%;overflow:hidden}.giftCardImage uni-image[data-v-37d92636]{width:100%;height:100%}.giftCardHint[data-v-37d92636]{position:absolute;bottom:0;left:0;width:100%;height:16px;font-size:8px;background-color:rgba(0,0,0,.4);color:#fff;text-align:center;line-height:16px}.giftCardText[data-v-37d92636]{-webkit-box-flex:1;-webkit-flex:1;flex:1;height:68px;position:relative}.giftCardName[data-v-37d92636]{width:100%;height:24px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.giftCardType[data-v-37d92636]{display:inline-block;width:40px;height:16px;background-color:#ff1558;color-interpolation:#fff;color:#fff;border-radius:50px;text-align:center;line-height:16px;font-size:10px;margin-left:%?20?%}.sureBtn[data-v-37d92636]{width:100%;height:%?100?%;text-align:center;line-height:%?100?%;color:#fff;background-color:#ff1558}.giftCardRange[data-v-37d92636]{width:100%;height:15px;line-height:15px;color:#999;padding-right:20px;font-size:11px}.giftPrice[data-v-37d92636]{font-size:16PX;line-height:22px;color:#ff1558;height:22px}.giftCardPriceInfo[data-v-37d92636]{width:100%;height:17px;line-height:17px;display:-webkit-box;display:-webkit-flex;display:flex;color:#002537;position:relative;font-size:12px;margin-top:12px}.giftCardPriceAll[data-v-37d92636]{width:auto;margin-right:%?40?%}.giftCardPriceAll uni-text[data-v-37d92636]{color:#ff1558}.payChooseBtn[data-v-37d92636]{width:%?36?%;height:%?36?%;background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/oval_3copy4@2x.png) no-repeat 50%;background-size:%?36?% %?36?%;position:absolute;right:%?20?%;top:%?80?%}.payChooseBtn.active[data-v-37d92636]{background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/subr.png) no-repeat 50%;background-size:%?36?% %?36?%}.detailsBtn[data-v-37d92636]{width:%?80?%;height:17px;display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;position:absolute;right:%?0?%;bottom:0;color:#666}.arrowIcon[data-v-37d92636]{width:%?20?%;height:%?10?%;background:url(http://beifa-mall.oss-cn-shanghai.aliyuncs.com/appletsImages/coupon_cannotusearrow@2x.png) no-repeat 50%;background-size:%?20?% %?10?%;margin-left:%?10?%}.arrowIcon.active[data-v-37d92636]{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.giftCardDetailsTitle[data-v-37d92636]{width:100%;padding:24px 0 6px;color:#333;line-height:16px}.goodsList[data-v-37d92636]{width:100%}.goodsListParent[data-v-37d92636]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-wrap:nowrap;flex-wrap:nowrap}.everyGoodsRow[data-v-37d92636]{width:90px;margin-right:12px}.everyGoodsRow uni-image[data-v-37d92636]{width:90px;height:90px}.goodsName[data-v-37d92636]{width:100%;height:28px;text-align:center;line-height:14px;margin-top:5px;font-size:11px;color:#999}",""]),e.exports=t},fa2a:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return i}));var i={uniPopup:a("1c89").default},s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"page"},[a("uni-popup",{ref:"giftCardInfo",attrs:{type:"bottom"}},[a("v-uni-view",{staticClass:"cardList"},[a("v-uni-view",{staticClass:"cardTitle"},[e._v("我的礼卡")]),a("v-uni-scroll-view",{staticClass:"giftCardList",attrs:{"scroll-y":"true"}},e._l(e.cardInfo.usableCards,(function(t,i){return a("v-uni-view",{key:t.cardNo,staticClass:"everyRowParent"},[a("v-uni-view",{staticClass:"everyRow"},[e.payInfo.memberAsset.cardAmount?e._e():a("v-uni-view",{staticClass:"mask"}),a("v-uni-view",{staticClass:"giftCardInfo"},[a("v-uni-view",{staticClass:"giftCardImage"},[a("v-uni-image",{attrs:{src:e.imgBaseUrls+t.cover,mode:""}}),a("v-uni-view",{staticClass:"giftCardHint"},[e._v("有效期至："+e._s(e.$utils.formatDate(new Date(t.expireTime),"yyyy-MM-dd")))])],1),a("v-uni-view",{staticClass:"giftCardText"},[a("v-uni-view",{staticClass:"giftCardName"},[a("v-uni-text",[e._v(e._s(t.cardName))]),a("v-uni-text",{staticClass:"giftCardType"},[e._v("推荐")])],1),a("v-uni-view",{staticClass:"giftCardRange"},[1==t.scope?a("v-uni-text",[e._v("可用范围：全平台通用")]):e._e(),2==t.scope?a("v-uni-text",[e._v("可用范围：部分店铺可用")]):e._e(),3==t.scope?a("v-uni-text",[e._v("可用范围：部分店铺不可用")]):e._e(),4==t.scope?a("v-uni-text",[e._v("可用范围：部分商品可用")]):e._e()],1),t.selectedAmount?a("v-uni-view",{staticClass:"giftPrice"},[e._v("￥"+e._s(t.selectedAmount))]):e._e()],1),a("v-uni-view",{staticClass:"payChooseBtn",class:t.seleted?"active":"",on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.chooseChange(t)}}})],1)],1),a("v-uni-view",{staticClass:"giftCardPriceInfo"},[a("v-uni-view",{staticClass:"giftCardPriceAll"},[e._v("余额："),a("v-uni-text",[e._v("￥"+e._s(t.cardAmount))])],1),a("v-uni-view",{staticClass:"giftCardPriceAll"},[e._v("本次可用："),a("v-uni-text",[e._v("￥"+e._s(t.usefulAmount))])],1),a("v-uni-view",{staticClass:"detailsBtn",on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.detailsChange(t)}}},[e._v("详情"),a("v-uni-view",{staticClass:"arrowIcon",class:t.flag?"active":""})],1)],1),t.flag?a("v-uni-view",{staticClass:"giftCardDetails"},[a("v-uni-view",{staticClass:"giftCardDetailsTitle"},[e._v("当前礼卡可支付的商品")]),a("v-uni-scroll-view",{staticClass:"goodsList",attrs:{"scroll-x":"true"}},[a("v-uni-view",{staticClass:"goodsListParent"},e._l(t.goodsList,(function(t,i){return a("v-uni-view",{key:i,staticClass:"everyGoodsRow"},[a("v-uni-image",{attrs:{src:e.imgBaseUrls+t.imgUrl,mode:""}}),a("v-uni-view",{staticClass:"goodsName"},[e._v(e._s(t.name))])],1)})),1)],1)],1):e._e()],1)})),1),a("v-uni-view",{staticClass:"sureBtn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.closeGiftCardPopup.apply(void 0,arguments)}}},[e._v("完成")])],1)],1)],1)},n=[]}}]);